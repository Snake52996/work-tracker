# WT(Work Tracker): 这是一个前端网页式工具，用于记录您品鉴过的作品

本项目是用于开发WT的源码库。无论你对WT感到有趣、困惑还是质疑，这里的源码都会为您保持开放，等待您的检查。当然，在多数情况下，您可以直接访问[此网址](https://snake.moe/wt/)，而无需下载整个源码库。

## Work Tracker 是什么？

Work Tracker是一个前端网页式工具，用于记录您品鉴过的作品，并且它只在您自己的电脑上运行。
我们能品鉴的作品浩如烟海，但我们有时却会忘记自己品鉴过某部作品，或者忘记自己对某个作品的评价是什么。一些优秀的作品让人看后深受触动，心生敬仰，一些人会通过写文章的方式，专门记录下自己的感受和反应。然而，想对每个作品都撰文记录既耗时又耗力，且有很大一部分作品难以给出“特别好”或者“特别坏”的评价。
**这就是WT的亮点。**你可以用这个小工具来记录你品鉴过的作品，给它们打分评级、或是撰写或长或短的评论。你不需要注册什么账户，也不需要把数据上传网络，只需要专注于随心所欲地创造内容：_那些独属于你个人的美好回忆_。因为WT是网页工具，所以你不需要下载或者安装，只要点击链接打开浏览器就可以直接使用！

从一定程度上来说，WT特别适合那些“赛博松鼠”们，他们（我们）近乎疯狂地收集自己喜欢的作品，把它们保存在硬盘里，然后再找时间细细品鉴。他们恐怕再难回忆起某些作品的来源，也难以确认它们是否被自己收录过了，尤其是当它们被存在了不同的设备或者不同的地方里。
另一种可能的情况是，他们被一些作品的封面或者简介所吸引，深入了解后却发现其内容不尽人意，于是出于节约空间的考虑，没有把它们收录到硬盘里。不久之后，他们又刷到了这些作品，于是再一次落入陷阱之中，开启新的循环……
**这就是WT的亮点。**WT的自由度很高，你可以按照自己的喜好，轻松地管理你收集到的作品的元数据。即使是那些被你嫌弃的作品，你也可以给它们打上“已移除”的标签，判上低分，写下你内心对它们的厌恶；下次再看到的时候，你就知道它被你移除有迹可循、绝非意外。

## 使用说明

该工具使用的数据库对文件结构有严格的要求，至于具体要求了什么，你无需在意。你只需跟随链接的导引就可以构建自己的数据库。该数据库将保存在你自己的电脑里。
除此之外，因为浏览器的安全限制，以及WT不具有任何后端支持，WT无法自动更新您的数据库。每当您对数据库进行了修改，标题栏的右侧就会出现一个下载图标，当您点击它时，就会生成并下载您数据库的**增量**文件，扩展名为zip。您只需从zip文件中提取该增量文件（即解压zip文件），并将其覆盖掉原数据库的文件，就可以实现数据库的更新。

**注意**
虽然WT能够基本满足需求，而且我们每天都在使用它，但是它并没有经过彻底的检验，您需要自行承担可能的风险。我们**强烈推荐**您**备份**您的宝贵数据。如果您发现WT存在任何问题，欢迎您通过Issues向我们报告，或者通过PR来贡献您的力量，我们会竭诚为您服务。

## 特征

- **仅有前端**：WT完全在您自己的设备上运行，不依赖任何特定服务器，这从根源上减少了数据迁移不便和被他人窥视的可能性。您的数据只属于您，仅此而已。
- **固有安全性**：在WT设计之初，我们就将如何应对非法访问，保障数据安全置于至关重要的地位。我们用很强的加密算法保护您的数据库，并且十分审慎地去选取新的依赖项：避免不必要的依赖，并且更偏爱那些被频繁使用，广泛测试，积极更新的依赖。当然，要想使我们的设计得以发挥，您需要阅读[安全性相关](#安全性相关)。
- **灵活机动**：您可以在创建您的数据库的时候，设计其中每个条目具有的类型。我们提供三种类型来实现您的需求，这些类型可以被设置成可选的，并且可以按照您喜欢的方式排序。
  - _字符串_：用于书写文本。您可以将其设为独一无二的。
  - _评分_：用于打分。您也可以在评分时添加一个评价字符串。您可以给每个分数赋予一个隐含的含义来帮助您做出决定，比如当您给出一个4/5时，意味着“这个故事符合逻辑、发人深省、铺垫得当，但还不足以称为完美”。
  - _标签组_：您可以使用若干个短字符串（标签）进行作品标注，也可以从已有标签中选择添加。您可以把一些标签组设置为“单槽标签组”，在此情况下，您只能向其中添加一个标签。
- **同步准备就绪**：WT作为仅有前端的应用，不提供实现多端同步的内置服务。不过，您可以从一个URL来加载数据库，您的数据库会被加密，可以很安全地上传网络，这意味着您可以把它放在一个能提供可预测直链文件存储平台上，实现多端同步。您也可以把您的数据库储存在任意文件同步平台上，因为数据库中的文件修改时间窗口是可预测的，且完全由您掌握。相关建议请阅读[安全性相关](#安全性相关)。

## 安全性相关

本应用专为安全性设计，且由强大的现代加密算法赋能，但为了让这些设计能正常工作，还是需要您特别留意。请查看以下建议。

- **请勿在不信任的设备上开放您的数据库**:您不该在不信任的设备上录入您的机密信息，同样，您也不该将自己的数据库录入其中。他人可以通过修改您的操作系统来窃取您数据库中携有的任何信息，而这几乎无法防御。您在网页上运行本工具同时受到操作系统和浏览器的管理，这意味着即使您完全信任操作系统，您的浏览器也不会意识到您的数据库如此机密。因此，我们强烈建议您在完全信任的设备上运行此工具。
- **使用一个值得信赖且现代的浏览器**:您选择的浏览器将会进行数据的操作、加密算法的执行。您需要一个值得信赖且更新快速的浏览器，在漏洞出现时能被及时地修正。我们推荐 [Mozilla Firefox](https://www.firefox.com/).
- **使用高强度的密码**:任何人只要拥有数据库和密码就可以访问其中的数据。如果您只是把密码简单地设置为`123456`，那无论多强的加密算法都保护不了您的数据安全。您的密码应该足够长、包含多种字符并且难以被猜到，尤其在实现多端同步时。

## WT注入器

_这一小节要求使用者对JavaScript编程有基本了解_
当您在网上遇到了某一作品，想要手动搜查它是否已经存在于您的数据库之中是非常麻烦的。又因为我们总是从少数几个网站获取作品的相关信息，所以我们可以为这些网站编写并注入用户脚本，来进行信息的自动搜查。
不同的网站往往拥有不同的结构，因此我们无法编写出一个万能脚本，而需要因“地”制宜地去写代码。
不过这话又说回来了，我们想向您介绍我们的WT注入器，它能帮您完成那些无聊乏味的工作：它能给您提供一个可交互的用户界面，让您能在指定的网站上配置用到的数据库和脚本，实现数据库和脚本的更新，注入配置中指定的脚本，并为您的脚本提供解密和解析后的数据库。
WT注入器已被构建，您可以查阅[此网址](https://snake.moe/wt-injector/)中的说明来获取它，这份说明还将在WT注入器安装好后充当配置页。数据库和脚本可以被分开配置，其中数据库只能用URL进行导入，而脚本既可以用URL导入，也可以被直接存放在配置中。所谓“配置”，在这里是指一个网页，或者说是一个主机名，它由正则表达式匹配，并且是您数据库和脚本的注入对象。
您的脚本可以是经典模式的也可以是模块形式的，前者用`eval()`来加载，后者用`import()`来导入。您需要根据不同形式的脚本，选择返回或输出以下对应的接口，以便注入器能正常工作。

```javascript
{
  run: (data: any[]) => Promise<void>;
  stop?: () => Promise<void>;
  reset_data?: (new_data: any[]) => Promise<void>;
}
```

其中，`run`负责运行脚本，`stop`负责终止脚本，`reset_data`则能在不重启脚本的情况下，用更快的方法替换您脚本中提供的数据库。`stop`和`reset_data`都是非必要提供的。没有`reset_data`的情况下，脚本或数据库的更新通过`stop`和`run`实现；如果同时没有`reset_data`和`stop`，那就只能通过重新加载网页来实现更新了。您可以参考以下代码片段来理解如何使用注入器的接口。

```javascript
// ------ in classic mode ------
(() => {
  function run(data) {
    // implementation here
  }
  function stop() {
    // implementation here
  }
  function reset_data(new_data) {
    // implementation here
  }
  return {
    run: run,
    stop: stop,
    reset_data: reset_data,
  };
})();
// -----------------------------

// ------ in module mode ------
export function run(data) {
  // implementation here
}
export function stop() {
  // implementation here
}
export function reset_data(new_data) {
  // implementation here
}
// ----------------------------
```

提供给脚本的数据是一个由对象构成的数组，其顺序与数据库中的条目出现的顺序相同。数据库中条目的全体都被映射到了对象中，其中键为条目的名称，值则取决于以下类型：

- _字符串_ 类型：值为字符串本身；
- _标签_ 类型：值为一个字符串数组，每个字符串对应一个标签；
- _评分_ 类型：值为一个`{ score: number, comment?: string }`的对象
  非必要类型缺失时，其不会出现在对象中。

## 构建与开发

本节写给想构建本应用实例或者参与开发的人。

### 构建实例

本应用使用前端开发的常用工作流。我们的包管理器为[bun](https://bun.sh/#getting-started)，不过您也可以用自己喜欢的。请使用`bun install`来安装依赖，如此一来您就可以开发了。
有三个配置文件用于构建此项目，第一个用于主应用，第二个用于注入器，第三个用于注入器配置页。您可以使用以下脚本：

- `build:app`: 构建主应用
- `build:userscript`: 构建注入器
- `build:userscript-configure-page`: 构建配置页
- `build`: 构建以上所有

### 开发WT注入器

在您提交对WT注入器的修改（或者说对`src/extension`下的文件修改）之前，请遵从以下规范。

1. 除了对index.html， main.ts 和 ConfigurePage.vue的修改以外，绝大多数情况下都需要更新UserScript的版本，您可以在entry.ts处设置其版本。

2. 每当对类InjectorConfiguration提供的接口进行不前项兼容的修改时，您都需要在versions.json中给interface_version的值增加1。这确保了配置页面与它所依赖的后端用户脚本同步。

3. 每当对保存（转储）配置的格式进行更改时，您都需要在versions.json中给format_version的值增加1。

## 许可

[GNU Affero General Public License](https://www.gnu.org/licenses/agpl-3.0.en.html#license-text)
有关我们的开源依赖及其许可，请查阅我们应用中的许可页，或者查阅package.json这一文件。
